/*!
 * dpr-observer
 * An observer for listening to the change of device pixel ratio in browser.
 * 
 * @version 0.0.2
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2020 Zhongxiang.Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
"use strict";function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e}).apply(this,arguments)}function n(e){return e&&"function"==typeof e}function i(){var e=1;return"undefined"!=typeof window&&(e=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI||1),e}var t,a,r,o="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)},s="undefined"!=typeof window&&(window.cancelAnimationFrame&&window.cancelAnimationFrame.bind(window)||window.msCancelAnimationFrame&&window.msCancelAnimationFrame.bind(window)||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||function(e){return clearTimeout(e)},d="undefined"!=typeof window&&n(window.matchMedia),c=!!function(){var e=0,n=navigator.userAgent;return"Microsoft Internet Explorer"===navigator.appName?(new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(n),e=parseFloat(RegExp.$1)):n.indexOf("Trident")>-1&&n.indexOf("rv:11.0")>-1&&(e=11),e}(),u={fallbackToAnimationListener:!0},w=function(){function t(i,t){if(t=e({},u,t||{}),!d&&!t.fallbackToAnimationListener)throw new Error("DprObserver cannot run without `matchMedia` supported!\n        Please try to specify `fallbackToAnimationListener` as true to enable animation listener.");if(!n(i))throw new Error("the required param `onchange` must be a function!");this._onchange=i,!d&&t.fallbackToAnimationListener||c?this._createAnimationListener():this._createMediaMatcher()}var a=t.prototype;return a._createMediaMatcher=function(){var e=this,n="(resolution: "+i()+"dppx)";this._mediaMatcher=window.matchMedia(n),this._mediaMatcher.addListener(this._updateListener=function(){e._onchange(i()),e._disposeMediaMatcher(),e._createMediaMatcher()})},a._createAnimationListener=function(){var e=this,n=i();this._updateListener=o((function t(){var a=i();n!==a&&e._onchange&&e._onchange(n=a),o(t)}))},a._disposeMediaMatcher=function(){this._mediaMatcher&&(this._mediaMatcher.removeListener(this._updateListener),this._mediaMatcher=null)},a._disposeAnimationListener=function(){this._updateListener&&s(this._updateListener)},a.dispose=function(){this._disposeAnimationListener(),this._disposeMediaMatcher(),this._updateListener&&(this._updateListener=null),this._onchange=null},a.getDpr=function(){return i()},t}();r="0.0.2",(a="version")in(t=w)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,module.exports=w;
