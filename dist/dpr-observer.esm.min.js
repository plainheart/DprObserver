/*!
 * dpr-observer
 * An observer for listening to the change of device pixel ratio in browser.
 * 
 * @version 0.0.4
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2020 Zhongxiang.Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function n(){return(n=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}function i(e){return e&&"function"==typeof e}function r(){var e=1;return"undefined"!=typeof window&&(e=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI||1),e}var a="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)},o="undefined"!=typeof window&&(window.cancelAnimationFrame&&window.cancelAnimationFrame.bind(window)||window.msCancelAnimationFrame&&window.msCancelAnimationFrame.bind(window)||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||function(e){return clearTimeout(e)},s=document.addEventListener?function(e,n,t){e&&n&&t&&e.addEventListener(n,t,!1)}:function(e,n,t){e&&n&&t&&e.attachEvent("on"+n,t)},d=document.removeEventListener?function(e,n,t){e&&n&&e.removeEventListener(n,t,!1)}:function(e,n,t){e&&n&&e.detachEvent("on"+n,t)},c="undefined"!=typeof window&&i(window.matchMedia),u=!!function(){var e=0,n=navigator.userAgent;return"Microsoft Internet Explorer"===navigator.appName?(new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(n),e=parseFloat(RegExp.$1)):n.indexOf("Trident")>-1&&n.indexOf("rv:11.0")>-1&&(e=11),e}(),h=["matchMedia","animationFrame","resize"],w={tech:h,preferResize:!1,fallback:!0},f=function(){function e(e,r){if(!i(e))throw new Error("the required param `onchange` must be a function!");this._onchange=e;var a=(r=n({},w,r||{})).tech||h;if("string"==typeof a){if(-1===!h.indexOf(a))throw new Error("unsupported tech `"+a+"`, only "+h.join(", ")+" supported.");-1!==a.indexOf(",")&&(a=a.split(","))}r.preferResize&&(-1===a.indexOf("resize")?a.unshift("resize"):a="resize".concat(a.filter("resize"!==t)));for(var o,s=a.length,d=0;d<s;d++)if(o=a[d],-1!==h.indexOf(o)){if(this._init(o))break;if(!r.fallback)throw new Error("The tech `"+o+"` seems to be not supported. Please enable `fallback` to try others techs.");!0,console.warn("The tech `"+o+"` seems to be not supported.")}else console.warn("Unsupported tech `"+o+"`.")}var f=e.prototype;return f._init=function(e){switch(e){case"resize":this._createResizeListener();break;case"matchMedia":if(!c||u)return!1;this._createMediaMatcher();break;case"animationFrame":this._createAnimationListener()}return!0},f._createResizeListener=function(){var e=this,n=r();s(window,"resize",this._updateListener=function(t){var i=r();n!==i&&e._onchange&&e._onchange({tech:"resize",oldDpr:n,dpr:n=i,event:t})})},f._createMediaMatcher=function(){var e=this,n=r(),t="(resolution: "+n+"dppx)";this._mediaMatcher=window.matchMedia(t),this._mediaMatcher.addListener(this._updateListener=function(t){var i=r();e._onchange({tech:"matchMedia",oldDpr:n,dpr:n=i,event:t}),e._disposeMediaMatcher(),e._createMediaMatcher()})},f._createAnimationListener=function(){var e=this,n=r();this._updateListener=a((function t(i){var o=r();n!==o&&e._onchange&&e._onchange({tech:"animationFrame",oldDpr:n,dpr:n=o,event:{handle:e._updateListener,ts:i}}),a(t)}))},f._disposeResizeListener=function(){this._updateListener&&d(window,"resize",this._updateListener)},f._disposeMediaMatcher=function(){this._mediaMatcher&&(this._mediaMatcher.removeListener(this._updateListener),this._mediaMatcher=null)},f._disposeAnimationListener=function(){this._updateListener&&o(this._updateListener)},f.dispose=function(){this._disposeAnimationListener(),this._disposeResizeListener(),this._disposeMediaMatcher(),this._updateListener&&(this._updateListener=null),this._onchange=null},f.getDpr=function(){return r()},e.getDpr=function(){return r()},e}();e(f,"version","0.0.4"),e(f,"TECH_RESIZE","resize"),e(f,"TECH_MATCH_MEDIA","matchMedia"),e(f,"TECH_ANIMATION_FRAME","animationFrame");export default f;
