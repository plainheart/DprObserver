/*!
 * dpr-observer
 * An observer for listening to the change of device pixel ratio in browser.
 * 
 * @version 0.0.4
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2020 Zhongxiang.Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).DprObserver=n()}(this,(function(){"use strict";function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function n(){return(n=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}function i(e){return e&&"function"==typeof e}function r(){var e=1;return"undefined"!=typeof window&&(e=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI||1),e}var o="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)},a="undefined"!=typeof window&&(window.cancelAnimationFrame&&window.cancelAnimationFrame.bind(window)||window.msCancelAnimationFrame&&window.msCancelAnimationFrame.bind(window)||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||function(e){return clearTimeout(e)},s=document.addEventListener?function(e,n,t){e&&n&&t&&e.addEventListener(n,t,!1)}:function(e,n,t){e&&n&&t&&e.attachEvent("on"+n,t)},d=document.removeEventListener?function(e,n,t){e&&n&&e.removeEventListener(n,t,!1)}:function(e,n,t){e&&n&&e.detachEvent("on"+n,t)},c="undefined"!=typeof window&&i(window.matchMedia),u=!!function(){var e=0,n=navigator.userAgent;return"Microsoft Internet Explorer"===navigator.appName?(new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(n),e=parseFloat(RegExp.$1)):n.indexOf("Trident")>-1&&n.indexOf("rv:11.0")>-1&&(e=11),e}(),f="matchMedia",h="animationFrame",p="resize",w=[f,h,p],m={tech:w,preferResize:!1,fallback:!0},l=function(){function e(e,r){if(!i(e))throw new Error("the required param `onchange` must be a function!");this._onchange=e;var o=(r=n({},m,r||{})).tech||w;if("string"==typeof o){if(-1===!w.indexOf(o))throw new Error("unsupported tech `"+o+"`, only "+w.join(", ")+" supported.");-1!==o.indexOf(",")&&(o=o.split(","))}r.preferResize&&(-1===o.indexOf(p)?o.unshift(p):o=p.concat(o.filter(t!==p)));for(var a,s=o.length,d=0;d<s;d++)if(a=o[d],-1!==w.indexOf(a)){if(this._init(a))break;if(!r.fallback)throw new Error("The tech `"+a+"` seems to be not supported. Please enable `fallback` to try others techs.");!0,console.warn("The tech `"+a+"` seems to be not supported.")}else console.warn("Unsupported tech `"+a+"`.")}var l=e.prototype;return l._init=function(e){switch(e){case p:this._createResizeListener();break;case f:if(!c||u)return!1;this._createMediaMatcher();break;case h:this._createAnimationListener()}return!0},l._createResizeListener=function(){var e=this,n=r();s(window,"resize",this._updateListener=function(t){var i=r();n!==i&&e._onchange&&e._onchange({tech:p,oldDpr:n,dpr:n=i,event:t})})},l._createMediaMatcher=function(){var e=this,n=r(),t="(resolution: "+n+"dppx)";this._mediaMatcher=window.matchMedia(t),this._mediaMatcher.addListener(this._updateListener=function(t){var i=r();e._onchange({tech:f,oldDpr:n,dpr:n=i,event:t}),e._disposeMediaMatcher(),e._createMediaMatcher()})},l._createAnimationListener=function(){var e=this,n=r();this._updateListener=o((function t(i){var a=r();n!==a&&e._onchange&&e._onchange({tech:h,oldDpr:n,dpr:n=a,event:{handle:e._updateListener,ts:i}}),o(t)}))},l._disposeResizeListener=function(){this._updateListener&&d(window,"resize",this._updateListener)},l._disposeMediaMatcher=function(){this._mediaMatcher&&(this._mediaMatcher.removeListener(this._updateListener),this._mediaMatcher=null)},l._disposeAnimationListener=function(){this._updateListener&&a(this._updateListener)},l.dispose=function(){this._disposeAnimationListener(),this._disposeResizeListener(),this._disposeMediaMatcher(),this._updateListener&&(this._updateListener=null),this._onchange=null},l.getDpr=function(){return r()},e.getDpr=function(){return r()},e}();return e(l,"version","0.0.4"),e(l,"TECH_RESIZE",p),e(l,"TECH_MATCH_MEDIA",f),e(l,"TECH_ANIMATION_FRAME",h),l}));
